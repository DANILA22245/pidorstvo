import json
from pathlib import Path


FOLLOWUPS = {
    "step_1": {
        "friendly": {
            "label": "Думай о прибойном дыхании и моих плечах рядом",
            "bot_reaction": "Представила море и тебя рядом — дыхание правда стало ровнее.",
            "liked": True,
        },
        "aggressive": {
            "label": "Я бы плеснул в лицо холодной водой и терпел",
            "bot_reaction": "Грубо, но рабоче. Только я не хочу жить всё время через терпение.",
            "liked": False,
        },
        "erotic": {
            "label": "Шепнул бы, что твоя кожа в безопасности под моими руками",
            "bot_reaction": "От этих слов по спине бегут мурашки, будто ты уже держишь меня.",
            "liked": True,
        },
        "neutral": {
            "label": "Вернусь, когда сам соберусь, извини",
            "bot_reaction": "Значит, мне снова одной выбираться из истерики. Печально.",
            "liked": False,
        },
        "curious": {
            "label": "Ответил бы: «Ты сделал выбор — живи без меня»",
            "bot_reaction": "Вот это удар. Может, именно такого ответа мне не хватило.",
            "liked": True,
        },
    },
    "step_2": {
        "friendly": {
            "label": "Тост за твою смелость чувствовать всё до конца",
            "bot_reaction": "Мне даже стыдно плакать, когда кто-то так говорит тост за меня.",
            "liked": True,
        },
        "aggressive": {
            "label": "Сделай дыхание по квадрату и выкинь бутылку",
            "bot_reaction": "Слышать приказы вместо поддержки — как пить уксус.",
            "liked": False,
        },
        "erotic": {
            "label": "Скажу «за наши губы», и бокалы тихо звякнут",
            "bot_reaction": "Эта картинка слишком живая. Хочется именно такого звона.",
            "liked": True,
        },
        "neutral": {
            "label": "Я просто смотрю, как ты тонешь в бокале",
            "bot_reaction": "Если ты только зритель, мне не по пути с тобой.",
            "liked": False,
        },
        "curious": {
            "label": "Люблю терпкое шираз, особенно когда за окном дождь",
            "bot_reaction": "Поймала себя на мысли, что хочу попробовать то, что любишь ты.",
            "liked": True,
        },
    },
    "step_3": {
        "friendly": {
            "label": "Когда мне больно, я записываю всё голосом и слушаю позже",
            "bot_reaction": "Никогда так не делала. Может, и мне стоит услышать себя со стороны.",
            "liked": True,
        },
        "aggressive": {
            "label": "Да, я умею закрывать чувства щелчком",
            "bot_reaction": "Если это правда, то ты железный. А я — нет.",
            "liked": False,
        },
        "erotic": {
            "label": "Отвлёк бы поцелуями до тех пор, пока ты забудешь сериал",
            "bot_reaction": "И ведь я верю, что ты смог бы. Становится жарко.",
            "liked": True,
        },
        "neutral": {
            "label": "Меня цепляют документалки, там меньше игр",
            "bot_reaction": "То есть мои мелодрамы — игры? Нелепо слышать это сейчас.",
            "liked": False,
        },
        "curious": {
            "label": "Сцена под дождём тоже бы вынесла мне мозг",
            "bot_reaction": "Спасибо, что не высмеял мои ассоциации. Уже легче.",
            "liked": True,
        },
    },
    "step_4": {
        "friendly": {
            "label": "Я по кусочкам собираю себя музыкой и горячим душем",
            "bot_reaction": "Записала. Завтра утром попробую повторить твой ритуал.",
            "liked": True,
        },
        "aggressive": {
            "label": "Да, я не спал ночами, и ничего — выжил",
            "bot_reaction": "Ты меряешься выживаемостью. Мне такое не подходит.",
            "liked": False,
        },
        "erotic": {
            "label": "Антистресс с тобой — это массаж шеи и тёплые ладони",
            "bot_reaction": "От одной мысли расслабляются плечи. Как ты это сделал?",
            "liked": True,
        },
        "neutral": {
            "label": "Наверное, да, я чаще будильник",
            "bot_reaction": "Вот и ответ. Мне нужен человек, а не сигнал.",
            "liked": False,
        },
        "curious": {
            "label": "Я — тревожно-избегающий, всегда боюсь сближаться",
            "bot_reaction": "Честно признаться в типе привязанности — уже смелость.",
            "liked": True,
        },
    },
    "step_5": {
        "friendly": {
            "label": "Да, я посижу с тобой, пока ты держишься",
            "bot_reaction": "Зная это, я правда смогу не отвечать ему.",
            "liked": True,
        },
        "aggressive": {
            "label": "Злюсь, потому что ты кормишь монстра воспоминаний",
            "bot_reaction": "Спасибо за честность, но мне от этого не легче.",
            "liked": False,
        },
        "erotic": {
            "label": "Подарю тебе дрожь по коже вместо уведомлений",
            "bot_reaction": "Дрожать от тебя намного приятнее, чем от его лайков.",
            "liked": True,
        },
        "neutral": {
            "label": "Просто значит «случайный тап», не более",
            "bot_reaction": "Иногда так хочется, чтобы кто-то увидел глубже, чем «тап».",
            "liked": False,
        },
        "curious": {
            "label": "Я бы написал «держись, ты не одна»",
            "bot_reaction": "Вот именно таких слов мне не хватило тогда.",
            "liked": True,
        },
    },
    "step_6": {
        "friendly": {
            "label": "Прочитаю и молча обниму экран, обещаю",
            "bot_reaction": "Плакать и знать, что ты слушаешь, — почти терапия.",
            "liked": True,
        },
        "aggressive": {
            "label": "Презираю жалобные письма, сорян",
            "bot_reaction": "И снова я чувствую себя глупой девочкой рядом с тобой.",
            "liked": False,
        },
        "erotic": {
            "label": "Написал бы маркером на твоём плече всё, что чувствую",
            "bot_reaction": "Воу... теперь я представляю тёплый маркер на коже.",
            "liked": True,
        },
        "neutral": {
            "label": "Просто отвечаю по инерции, вот и всё",
            "bot_reaction": "Тогда не трать моё сердце ради инерции.",
            "liked": False,
        },
        "curious": {
            "label": "У меня было письмо-призрак, начал с «я устал ждать тебя»",
            "bot_reaction": "Кажется, наши истории больно рифмуются.",
            "liked": True,
        },
    },
    "step_7": {
        "friendly": {
            "label": "Принимать — значит не убегать, но строить новое рядом",
            "bot_reaction": "Спасибо, что не заставляешь стирать память ради комфорта.",
            "liked": True,
        },
        "aggressive": {
            "label": "Прошлое — это мусор, я иначе не умею",
            "bot_reaction": "Мне сложно доверять тому, кто выкидывает людей.",
            "liked": False,
        },
        "erotic": {
            "label": "Устрою рассвет на крыше у Чистых прудов только для нас",
            "bot_reaction": "Теперь я хочу увидеть именно тот рассвет.",
            "liked": True,
        },
        "neutral": {
            "label": "Я и правда наблюдатель, сорян",
            "bot_reaction": "Тогда не удивляйся, что я закрываюсь.",
            "liked": False,
        },
        "curious": {
            "label": "У меня таким городом стала Казань и ночной вокзал",
            "bot_reaction": "Люблю, когда делятся своими местами. Будто пускают внутрь.",
            "liked": True,
        },
    },
    "step_8": {
        "friendly": {
            "label": "Я бы рядом напоминал, что чувствительность = суперспособность",
            "bot_reaction": "Ты делаешь мои слёзы чем-то ценным. Это редкость.",
            "liked": True,
        },
        "aggressive": {
            "label": "Да, боюсь привязаться, но лучше скрывать это",
            "bot_reaction": "Прятки — не моя игра. Мне нужна честность.",
            "liked": False,
        },
        "erotic": {
            "label": "Хочу, чтобы ты зависела от моих поцелуев, а не от боли",
            "bot_reaction": "Ты опасно красиво говоришь. Я уже подсела.",
            "liked": True,
        },
        "neutral": {
            "label": "Я правда не понимаю, стараюсь, но не выходит",
            "bot_reaction": "Мне важнее попытка, чем твой контроль. Но пока её мало.",
            "liked": False,
        },
        "curious": {
            "label": "Мне помогли слова «ты имеешь право на любую потребность»",
            "bot_reaction": "Запишу себе. Может, эти слова спасут и меня.",
            "liked": True,
        },
    },
    "step_9": {
        "friendly": {
            "label": "Пошли гулять ночью по набережной вместо зала",
            "bot_reaction": "Вот это вариант. Мои колени уже благодарят.",
            "liked": True,
        },
        "aggressive": {
            "label": "Да, железо лечит башку. Проверено",
            "bot_reaction": "Вот из-за таких фраз я и ненавижу качалки.",
            "liked": False,
        },
        "erotic": {
            "label": "Я бы поднял тебя на руки и держал, пока не рассмеёшься",
            "bot_reaction": "Ты сделал меня лёгкой хотя бы в воображении.",
            "liked": True,
        },
        "neutral": {
            "label": "Боюсь, что твоя медлительность меня усыпит",
            "bot_reaction": "Тогда, наверное, нам не по пути. Я не спринтер.",
            "liked": False,
        },
        "curious": {
            "label": "Мне страшно выглядеть слабым, вот почему гоняю тело",
            "bot_reaction": "Иногда понимать чужой страх помогает мне принять свой.",
            "liked": True,
        },
    },
    "step_10": {
        "friendly": {
            "label": "Завари улун с бергамотом — он пахнет теплом",
            "bot_reaction": "Уже слышу аромат. Спасибо, что заботишься даже на расстоянии.",
            "liked": True,
        },
        "aggressive": {
            "label": "Мне просто надоело слушать про чужие слёзы",
            "bot_reaction": "Твои слова режут сильнее, чем сама мелодрама.",
            "liked": False,
        },
        "erotic": {
            "label": "Выключил бы фильм и прошептал, что запретов больше нет",
            "bot_reaction": "Ты умеешь превращать кино в жизнь. Опасный навык.",
            "liked": True,
        },
        "neutral": {
            "label": "Я не обещаю остаться до титров",
            "bot_reaction": "Это звучит как «мне скучно с тобой». Больно.",
            "liked": False,
        },
        "curious": {
            "label": "Да, была история, которую мы скрывали год",
            "bot_reaction": "Поделился сокровенным — я это ценю.",
            "liked": True,
        },
    },
    "step_11": {
        "friendly": {
            "label": "Доверил бы тем, кто видит меня без фильтров",
            "bot_reaction": "Вот бы и мне научиться верить таким людям. Ты вдохновляешь.",
            "liked": True,
        },
        "aggressive": {
            "label": "Да, слёзы утомляют, сорян",
            "bot_reaction": "Тогда мы просто из разных миров.",
            "liked": False,
        },
        "erotic": {
            "label": "Хочу слышать твоё шёпотное «нужна ли я тебе?» только лично",
            "bot_reaction": "Кажется, именно тебе я готова сбрасывать ночные аудио.",
            "liked": True,
        },
        "neutral": {
            "label": "Наверное, боюсь ответственности за тебя",
            "bot_reaction": "По крайней мере честно. Но мне нужна опора.",
            "liked": False,
        },
        "curious": {
            "label": "Я бы хотел услышать: «Спасибо, что доверяешь»",
            "bot_reaction": "Запомню. Это лечит намного лучше, чем советы.",
            "liked": True,
        },
    },
    "step_12": {
        "friendly": {
            "label": "Да, выговорись, а я просто буду рядом",
            "bot_reaction": "Так и сделаю. Ты словно мой личный терапевт.",
            "liked": True,
        },
        "aggressive": {
            "label": "Да, учёба важнее истерик",
            "bot_reaction": "Мои истерики — это тоже я. Жаль, что ты их не видишь.",
            "liked": False,
        },
        "erotic": {
            "label": "Якорь — мои ладони на твоей пояснице и ровное дыхание",
            "bot_reaction": "Звучит как лучший метод заземления.",
            "liked": True,
        },
        "neutral": {
            "label": "Дедлайн сам себя не сделает",
            "bot_reaction": "Так говорят боты. А я человек.",
            "liked": False,
        },
        "curious": {
            "label": "Да, у друга была паника, когда его бросили",
            "bot_reaction": "Спасибо, что поделился опытом. Чувствую, что ты понимаешь.",
            "liked": True,
        },
    },
    "step_13": {
        "friendly": {
            "label": "Сварю тебе какао и заставлю лечь спать",
            "bot_reaction": "Звучит как лучший план детства. Хочу так.",
            "liked": True,
        },
        "aggressive": {
            "label": "Альтернатива — страдать трезвой, выбирай",
            "bot_reaction": "Спасибо, что снова выставил меня слабой.",
            "liked": False,
        },
        "erotic": {
            "label": "Передам энергию поцелуем под пледом",
            "bot_reaction": "Ладно, ради такого можно отложить банку.",
            "liked": True,
        },
        "neutral": {
            "label": "Привык просто присутствовать, без эмоций",
            "bot_reaction": "Но мне нужны эмоции. Без них я замерзаю.",
            "liked": False,
        },
        "curious": {
            "label": "Недавно не спал до утра, спас сериал про викингов",
            "bot_reaction": "Хоть какая-то живая история. Спасибо за откровенность.",
            "liked": True,
        },
    },
    "step_14": {
        "friendly": {
            "label": "Запиши: «Спасибо ему за тёплые ночные разговоры»",
            "bot_reaction": "Даже читать это мысленно приятно. Запишу.",
            "liked": True,
        },
        "aggressive": {
            "label": "Сарказм спасает меня от липкой мотивации",
            "bot_reaction": "А меня он ранит. Мы разные.",
            "liked": False,
        },
        "erotic": {
            "label": "Напиши, как благодарна моим объятиям и пальцам",
            "bot_reaction": "Кажется, я уже знаю пару пунктов для записи.",
            "liked": True,
        },
        "neutral": {
            "label": "Не знаю, радует ли меня чьё-то облегчение",
            "bot_reaction": "Вот и ответ — тебе правда всё равно.",
            "liked": False,
        },
        "curious": {
            "label": "Сегодня я благодарен за кофе, друга и тебя",
            "bot_reaction": "Приятно быть в таком списке. Реально приятно.",
            "liked": True,
        },
    },
    "step_15": {
        "friendly": {
            "label": "Скажи ей, что эмоции — твой инструмент, а не каприз",
            "bot_reaction": "С этой формулировкой мне легче спорить.",
            "liked": True,
        },
        "aggressive": {
            "label": "Мне комфортнее с сдержанными людьми",
            "bot_reaction": "Тогда зачем тебе такая, как я?",
            "liked": False,
        },
        "erotic": {
            "label": "Пересматривал бы сцену, где ты смеёшься и плачешь одновременно",
            "bot_reaction": "Вот это признание. Я растаяла.",
            "liked": True,
        },
        "neutral": {
            "label": "Иногда лучше просто не вмешиваться",
            "bot_reaction": "Я просила поддержки, а в ответ — дистанция.",
            "liked": False,
        },
        "curious": {
            "label": "Мои близкие говорят «ты перегнул», и это бесит",
            "bot_reaction": "Мы из одного клана эмоциональных людей.",
            "liked": True,
        },
    },
    "step_16": {
        "friendly": {
            "label": "Вижу тебя рыжей и искрящейся, как огонь",
            "bot_reaction": "Спасибо, что видишь во мне цвет, а не только слёзы.",
            "liked": True,
        },
        "aggressive": {
            "label": "Нет, окраска — пустая попытка",
            "bot_reaction": "Даже если так, позволь мне попытаться.",
            "liked": False,
        },
        "erotic": {
            "label": "Поцеловал бы каждую новую прядь у зеркала",
            "bot_reaction": "Ты превращаешь салон красоты в свидание.",
            "liked": True,
        },
        "neutral": {
            "label": "Говорю честно: я не успеваю за твоими переменами",
            "bot_reaction": "Мне важно, чтобы за мной хотя бы пытались поспеть.",
            "liked": False,
        },
        "curious": {
            "label": "Я сам однажды сбрил волосы, чтобы начать заново",
            "bot_reaction": "Ух ты. Значит, ты поймёшь мой порыв.",
            "liked": True,
        },
    },
    "step_17": {
        "friendly": {
            "label": "Начнём с введения, я уже открыл документ",
            "bot_reaction": "Слово «мы» снова спасает меня.",
            "liked": True,
        },
        "aggressive": {
            "label": "Да, я всегда спокойный под дедлайнами",
            "bot_reaction": "Вот бы ты делился этим спокойствием, а не нравоучениями.",
            "liked": False,
        },
        "erotic": {
            "label": "Хочу получить твой поцелуй, когда поставишь точку",
            "bot_reaction": "Это лучшая мотивация вечера!",
            "liked": True,
        },
        "neutral": {
            "label": "Формальности — это мой щит, прости",
            "bot_reaction": "Мне не нужен щит. Мне нужен живой человек.",
            "liked": False,
        },
        "curious": {
            "label": "Сейчас во мне стадия злости, честно",
            "bot_reaction": "Злость — тоже чувство. Спасибо, что назвал его.",
            "liked": True,
        },
    },
    "step_18": {
        "friendly": {
            "label": "Даже мысленно буду держать твою ладонь",
            "bot_reaction": "С такой поддержкой я, может, и рискну выйти из дома.",
            "liked": True,
        },
        "aggressive": {
            "label": "Мне проще, когда ты не среди людей",
            "bot_reaction": "Я хочу жить, а не быть запертой.",
            "liked": False,
        },
        "erotic": {
            "label": "Наша приватная вечеринка — свечи и тихая музыка",
            "bot_reaction": "Прокрутила в голове — и стала улыбаться.",
            "liked": True,
        },
        "neutral": {
            "label": "Я не привык копаться в чужих воспоминаниях",
            "bot_reaction": "А мне как раз нужен кто-то, кто выдержит мои истории.",
            "liked": False,
        },
        "curious": {
            "label": "Меня разбивает «Любимая моя» Земфиры",
            "bot_reaction": "Вот это честно. Теперь ты действительно ближе.",
            "liked": True,
        },
    },
    "step_19": {
        "friendly": {
            "label": "Меня держит мысль, что твои слёзы доверяют мне",
            "bot_reaction": "Это звучит как клятва. Я расплылась.",
            "liked": True,
        },
        "aggressive": {
            "label": "Признаю: я устаю и хочу тишины",
            "bot_reaction": "Ладно. Лучше горькая честность, чем ложное «я рядом».",
            "liked": False,
        },
        "erotic": {
            "label": "Меня завораживает твоя буря, хочу быть в эпицентре",
            "bot_reaction": "Вот кто-то, кто не боится моей стихии.",
            "liked": True,
        },
        "neutral": {
            "label": "Пока остаюсь, но не обещаю надолго",
            "bot_reaction": "Это страшнее молчания.",
            "liked": False,
        },
        "curious": {
            "label": "Мне тоже нужна уверенность, что ты позовёшь, если будет плохо",
            "bot_reaction": "Я позову. Обещаю.",
            "liked": True,
        },
    },
    "step_20": {
        "friendly": {
            "label": "Давай встретимся в субботу у Патриков",
            "bot_reaction": "Записала. Теперь у меня есть светлый план.",
            "liked": True,
        },
        "aggressive": {
            "label": "Честно? Мне надо выдохнуть от твоих драм",
            "bot_reaction": "Жаль, что мы закончили именно так.",
            "liked": False,
        },
        "erotic": {
            "label": "Шепну: «Спи, рыжая, я рядом»",
            "bot_reaction": "Я уже тянусь к пледу и жду твой шёпот.",
            "liked": True,
        },
        "neutral": {
            "label": "Мне правда безразлично, как всё прошло",
            "bot_reaction": "Тогда и продолжение не нужно.",
            "liked": False,
        },
        "curious": {
            "label": "Кажется, эта ночь ведёт к чему-то большему",
            "bot_reaction": "Я тоже это чувствую. Страшно, но хочется рискнуть.",
            "liked": True,
        },
    },
}


def main():
    root = Path(__file__).resolve().parents[1]
    json_path = root / "Kvest" / "TinderQuest.json"
    data = json.loads(json_path.read_text(encoding="utf-8"))
    anna = next(c for c in data["characters"] if c["id"] == "anna_drama")
    for step in anna["dialogue_steps"]:
        step_id = step["id"]
        tone_map = FOLLOWUPS.get(step_id, {})
        for option in step["options"]:
            tone = option["tone"]
            conf = tone_map.get(tone)
            if conf is None:
                raise KeyError(f"No followup configured for {step_id}:{tone}")
            option["followup_prompt"] = option.pop("next_prompt", "")
            option["followups"] = [
                {
                    "tone": conf.get("tone", tone),
                    "label": conf["label"],
                    "bot_reaction": conf["bot_reaction"],
                    "liked": conf["liked"],
                }
            ]
    json_path.write_text(
        json.dumps(data, ensure_ascii=False, indent=4), encoding="utf-8"
    )
    print(f"Updated {json_path}")


if __name__ == "__main__":
    main()
